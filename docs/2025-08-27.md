2025-08-27 데이터 엔지니어링... 파이프라인 및 진행계획
이후 프로젝트 진행 — Data Lake vs Data Warehouse, 그리고 우리의 로드맵
0) 한 줄 결론

Lakehouse-lite 전략이 최적:
**S3 데이터 레이크(브론즈/실버/골드)**를 중심으로 하면서, 초반에는 **RDS(Postgres)를 웨어하우스(서빙층)**으로 쓰고, 규모/동시성 임계치를 넘으면 Redshift Serverless 또는 Snowflake로 마이그레이션.

1) 개념 정리 (짧게)

Data Lake: S3 같은 오브젝트 스토리지에 모든 원천 데이터를 원형/반정형/비정형 포함 저장. 저비용·유연, 대신 스키마/성능은 별도 설계 필요.

Data Warehouse: 정형 데이터의 고성능 분석용 저장/쿼리(MPP, 컬럼식, 통계 최적화). 비용↑, 하지만 속도·동시성·거버넌스 강함.

Lakehouse: 둘을 결합(레이크에 저장, 웨어하우스/엔진으로 서빙). “S3 중심 + 필요한 만큼 WH”.

2) 우리가 채택할 구조(현재 상태에서 진화)
지금(MVP 완료 직전)

S3: RAW 파일 저장(브론즈에 해당).

RDS(Postgres): ODS/DIM(=실버/골드 역할) + KPI/리포트 쿼리.

Airflow on EC2: 오케스트레이션.

DQ: 하드/소프트 + Slack.

다음 단계(레이크 기초 강화)

Glue Data Catalog: S3 테이블 메타데이터 카탈로그.

Lake Formation(권장): 테이블/컬럼 권한 중앙 관리(거버넌스).

Athena: S3 직접 쿼리(운영/감사/원천 비교, 비용 가벼움).

파티셔닝/포맷: 브론즈/실버에 Parquet + 파티션(연/월/일 등)로 저장.

그 다음(웨어하우스 도입 기준 충족 시)

Redshift Serverless 또는 Snowflake 중 하나:

주 KPI·대시보드·다자 동시접속·대규모 조인/집계가 **지속 30초+**로 느려지거나,

데이터 볼륨 200~300GB+, 동시 사용자 10~20+, 스케줄 쿼리 100건+/일 수준이 되면 전환 검토.

초기에는 RDS 유지 + 핫 마트만 WH로 이행(하이브리드) → 완전 이관은 2단계.

3) 아키텍처 패턴: Medallion(브론즈/실버/골드) ↔ 우리의 RAW/ODS/DIM 매핑

Bronze = RAW(S3): 원형/보강 최소. 스키마 느슨, 메타칼럼 유지.

Silver = ODS(정제): 정타입/품질·무결성 적용, Parquet로 저장(또는 RDS에도 적재).

Gold = Mart(DIM/집계): 리포팅/피처/BI 최적화 테이블. (RDS → WH 마이그레이션 후보)

실무 팁: Silver/Gold를 S3 Parquet + Athena/Redshift Spectrum으로 읽게 해두면 서빙 엔진 교체에도 내성이 큽니다.

4) 운영·보안 설계(요점)

권한: IAM Role 원칙, Lake Formation으로 테이블/컬럼 권한, RDS는 SG 화이트리스트.

암호화: S3 SSE-KMS(규정 시), RDS 암호화, 백업/PITR.

관측: Airflow 로그 + DQ 결과 테이블 + Slack 알림 + Athena 쿼리 로그(데이터 접근 감사).

비밀관리: .env.aws → Secrets Manager/SSM 점진 이관.

5) 로드맵 (스프린트형, 각 1주 기준)
Sprint A — 레이크 기초 + DQ 대시보드

S3 브론즈 폴더 정리(olist/raw/…), 카탈로그(Glue) 등록.

Airflow에서 브론즈→실버 Parquet 변환 태스크 추가(파티션 설계).

ops.dq_results를 Metabase/QuickSight로 시각화(신선도·오차율 지표판).

Sprint B — 실버/골드 강화 + BI 연결

ODS 스키마/인덱스 튜닝(Top N 조인 키, 시간축).

골드 마트(매출/배송/리뷰/결제 KPI) 표준화 + BI 데이터셋 연결.

Athena로 원천과 ODS 간 샘플 대조(정확성 DQ).

Sprint C — 웨어하우스 PoC (조건부)

결정 기준 체크(느린 쿼리/볼륨/동시성). 기준 충족 시:

Redshift Serverless PoC: 실버/골드 일부를 외부 테이블(Spectrum) + 내부 테이블로 구성.

또는 Snowflake PoC: S3 Stage + Snowpipe(or Task)로 적재, 비용·성능 비교.

PoC 기준: 3가지 대표 쿼리(대용량 조인, 시간계열 집계, 동시 10세션)를 성능/비용으로 비교.

Sprint D — 운영 성숙도

Lake Formation 권한 라인업(분석가/운영자/ML 엔지니어 그룹).

백업/복구 리허설(PITR, 스냅샷).

MWAA 전환(필요 시), Slack 알림 룰/임계 재튜닝.

Sprint E — ML/피처 스토어(확장)

골드 마트 기반 피처 파이프라인: RFM, 최근성/빈도/금액, 지연율, 결제 믹스.

MLflow 실험 추적, 베이스라인 모델(Churn/Review Score).

A/B 테스트 설계와 서빙 연동(선택).

6) 의사결정 매트릭스(간단 버전)
기준	RDS(Postgres) 유지	Redshift Serverless	Snowflake
초기 비용/셋업	매우 낮음	낮음(서버리스)	낮음(서버리스)
운영 편의	익숙, 간단	관리형, MPP	완전관리형, MPP
대규모 집계 성능	중	높음	높음
동시성(다수 BI/쿼리)	중	높음	높음
생태계/확장성	풍부	AWS 내 통합 강함	외부 연동·기능 풍부
우리 현 시점 적합성	✅	조건부 PoC	조건부 PoC

추천: 지금은 RDS 유지, 성능/동시성 임계치 도달 시 Redshift Serverless PoC부터.

7) 구현 체크리스트(요약)

브론즈/실버 Parquet + 파티션: year=YYYY/month=MM/day=DD/

Glue 카탈로그 스키마 관리, 스키마 변화 대응 전략(옵셔널 컬럼, late binding).

DQ: 하드/소프트 룰 지속 보강(지연률, 환불률, 결제-아이템 합계 차이 등).

BI: 골드 마트를 주기 리프레시(증분) + 캐시 정책.

보안: IAM/LF/KMS/SG 점검, 비밀은 Secrets Manager에 단계 이관.